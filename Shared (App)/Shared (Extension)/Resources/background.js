(()=>{const e=e=>async(s,n,t={})=>{const r={method:s,params:t};e(`Sending message to SafariWebExtensionHandler: ${JSON.stringify(r)}`);const o=await browser.runtime.sendNativeMessage("ignored",r);if(e(`Result from message: ${JSON.stringify(o)}`),o.error)throw new Error(`Received error from SafariWebExtensionHandler: ${JSON.stringify(o)}`);return o},s=(e,s)=>(n,t,r={})=>{const o={destination:n,method:t,params:r,sessionId:s};return e(`Sending message to browser runtime: ${JSON.stringify(o)}`),browser.runtime.sendMessage(o)},n=(e,s)=>(n,t,r={})=>{const o={destination:n,method:t,params:r,sessionId:s};e(`Sending message to browser tabs: ${JSON.stringify(o)}`),browser.tabs.query({active:!0,currentWindow:!0},(e=>{const[s]=e;s&&s.id&&browser.tabs.sendMessage(s.id,o)}))},t=(e,s)=>(n,t={})=>{const r={method:n,params:t};return e(`Sending message to Ethereum.js: ${JSON.stringify(r)}`),s(r)},r=({logger:r})=>{const o=({method:e,params:s})=>n(r)("content",e,s),a=t(r,(e=>o({method:"forwardToEthereumJs",params:e})));return{sendToContent:o,sendToEthereumJs:a,sendToPopup:(e,n={})=>s(r)("popup",e,n),sendToNative:e(r)}},o=({logger:r})=>{const o=({method:e,params:s})=>n(r)("content",e,s),a=t(r,(e=>o({method:"forwardToEthereumJs",params:e})));return{sendToContent:o,sendToEthereumJs:a,sendToBackground:(e,n={})=>s(r)("background",e,n),sendToNative:e(r)}},a=({logger:e,sessionId:n})=>({sendToPopup:({method:t,params:r})=>s(e,n)("popup",t,r),sendToEthereumJs:({method:e,params:s})=>((e,s,n={})=>window.postMessage({destination:e,method:s,params:n}))("ethereum",e,s),sendToBackground:(t,r={})=>s(e,n)("background",t,r)}),d=(i="background",(e,...s)=>{const n=new XMLHttpRequest;n.onload=e=>{},n.open("POST",`http://localhost:8081/add?message=${e}&sender=${i}.js`,!0),n.send()});var i;const m=((e,s)=>{if("background"===e)return r(s);if("popup"===e)return o(s);if("content"===e)return a(s);throw new Error(`Unknown origin: ${e}`)})("background",{logger:d});browser.runtime.onMessage.addListener((async(e,s,n)=>{d(`Received message from browser runtime: ${JSON.stringify(e)}`);(async(s,n)=>{const{destination:t,method:r,sessionId:o,params:a}=e;"background"===t&&r===s&&(d(`Received method '${r}' with params: ${JSON.stringify(a)}`),await n(a,o))})("getState",(async(e,s)=>{const[t]=await m.sendToNative("eth_getAccounts",s),r=await m.sendToNative("eth_getBalance",s,{address:t});n({address:t,balance:r}),m.sendToPopup("updateState",{address:t,balance:r})}))})),d("loaded")})();
//# sourceMappingURL=background.js.map
