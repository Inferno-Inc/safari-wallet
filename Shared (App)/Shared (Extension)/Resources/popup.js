(()=>{const e=e=>async(n,t,s={})=>{const o={method:n,params:s};e(`Sending message to SafariWebExtensionHandler: ${JSON.stringify(o)}`);const r=await browser.runtime.sendNativeMessage("ignored",o);if(e(`Result from message: ${JSON.stringify(r)}`),r.error)throw new Error(`Received error from SafariWebExtensionHandler: ${JSON.stringify(r)}`);return r},n=(e,n)=>(t,s,o={})=>{const r={destination:t,method:s,params:o,sessionId:n};return e(`Sending message to browser runtime: ${JSON.stringify(r)}`),browser.runtime.sendMessage(r)},t=(e,n)=>(t,s,o={})=>{const r={destination:t,method:s,params:o,sessionId:n};e(`Sending message to browser tabs: ${JSON.stringify(r)}`),browser.tabs.query({active:!0,currentWindow:!0},(e=>{const[n]=e;n&&n.id&&browser.tabs.sendMessage(n.id,r)}))},s=(e,n)=>(t,s={})=>{const o={method:t,params:s};return e(`Sending message to Ethereum.js: ${JSON.stringify(o)}`),n(o)},o=({logger:o})=>{const r=({method:e,params:n})=>t(o)("content",e,n),a=s(o,(e=>r({method:"forwardToEthereumJs",params:e})));return{sendToContent:r,sendToEthereumJs:a,sendToPopup:(e,t={})=>n(o)("popup",e,t),sendToNative:e(o)}},r=({logger:o})=>{const r=({method:e,params:n})=>t(o)("content",e,n),a=s(o,(e=>r({method:"forwardToEthereumJs",params:e})));return{sendToContent:r,sendToEthereumJs:a,sendToBackground:(e,t={})=>n(o)("background",e,t),sendToNative:e(o)}},a=({logger:e,sessionId:t})=>({sendToPopup:({method:s,params:o})=>n(e,t)("popup",s,o),sendToEthereumJs:({method:e,params:n})=>((e,n,t={})=>window.postMessage({destination:e,method:n,params:t}))("ethereum",e,n),sendToBackground:(s,o={})=>n(e,t)("background",s,o)}),d=e=>"#"===e[0]?document.querySelector(e):document.querySelectorAll(e);const i=()=>window.close();const c={loading:{render:()=>"\n        <h1>Loading...</h1>\n    "},root:{render:()=>'\n        <h1>Safari Wallet</h1>\n        <div class="flex">\n            <button id="cancel" class="button button--secondary">Cancel</button>\n            <button id="connect" class="button button--primary">Connect</button>\n        </div>\n    '},connectWallet:{render:({address:e,balance:n})=>`\n        <h1>Connect to <span id="title"></span></h1>\n        <p class="subtitle"><span id="host"></span></p>\n        <p>When you connect your wallet, this dapp will be able to view the contents:</p>\n        <div class="field">\n            <label class="field__label" for="address">Address</label>\n            <input id="address" class="field__input" type="text" value="${e}" disabled>\n        </div>\n        <div class="field">\n            <label class="field__label" for="balance">ETH Balance</label>\n            <input id="balance" class="field__input" type="text" value="${(e=>{if("0x0"===e)return 0;e.startsWith("0x")&&(e=e.slice(2));let n="";for(var t=0;t<e.length;t+=2)n+=String.fromCharCode(parseInt(e.substr(t,2),16));return parseInt(n)})(n)/10**18} ${m[h].gasToken}" disabled>\n        </div>\n        <div class="flex">\n            <button id="cancel" class="button button--secondary">Cancel</button>\n            <button id="connect" class="button button--primary">Connect</button>\n        </div>\n    `,onRender:({onConnectWallet:e})=>{d("#cancel")?.addEventListener("click",i),d("#connect")?.addEventListener("click",e),browser.tabs.query({active:!0,currentWindow:!0},(e=>{const n=e[0],t=d("#title"),s=d("#host");t&&n.title&&(t.textContent=n.title),s&&n.url&&(s.textContent=new URL(n.url).host)}))}},signMessage:{render:()=>'\n        <h1>Sign Message</h1>\n        <div class="flex">\n            <button id="cancel" class="button button--secondary">Cancel</button>\n            <button id="sign" class="button button--primary">Sign</button>\n        </div>\n    ',onRender:({signMessage:e})=>{const n=d("#cancel"),t=d("#sign");n&&n.addEventListener("click",i),t&&t.addEventListener("click",e)}}},l=(e,n={})=>{if(!e||!Object.keys(c).includes(e))return void b(`Invalid view name: ${e}.`);const t=c[e];if(!t||!t.render)return void b(`Invalid view: ${e}.`);const s=d("#body");if(!s)return void b("Could not find body element.");const o=((e,n)=>c[e].render(n))(e,n);u(`Rendering view '${e}' with ${JSON.stringify(n)}`),u(`View contents: ${o}`),u(`Existing HTML: ${s.innerHTML}`),s.innerHTML=o,u(`Updated HTML: ${s.innerHTML}`),t.onRender&&t.onRender(n)},u=(p="popup",(e,...n)=>{const t=new XMLHttpRequest;t.onload=e=>{},t.open("POST",`http://localhost:8081/add?message=${e}&sender=${p}.js`,!0),t.send()});var p;const b=(e=>(n,...t)=>console.error(`[${e}.js] ${n}`,...t))("popup"),g=((e,n)=>{if("background"===e)return o(n);if("popup"===e)return r(n);if("content"===e)return a(n);throw new Error(`Unknown origin: ${e}`)})("popup",{logger:u}),m={1:{gasToken:"ETH"}},h=1;document.addEventListener("DOMContentLoaded",(()=>{var e,n;n=({address:e,balance:n})=>{l("connectWallet",{address:e,balance:n,onConnectWallet:()=>{g.sendToEthereumJs("walletConnected",{address:e,balance:n,chainId:h}),i()}})},u(`Listening to popup.${e="updateState"}`),browser.runtime.onMessage.addListener(((t,s)=>{const{destination:o,method:r,params:a}=t;"popup"===o&&r===e&&(u(`Received method '${r}' with params: ${JSON.stringify(a)}`),n(a,""))})),l("loading"),g.sendToBackground("getState"),u("loaded")}))})();
//# sourceMappingURL=popup.js.map
